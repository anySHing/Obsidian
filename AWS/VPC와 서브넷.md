VPC와 서브넷에 대해 AWS의 서비스 구조에 대해서 알아보자

우리가 Netflix, Github 등을 이용할 때는 퍼블릭 인터넷을 이용한다.

AWS 클라우드도 마찬가지로 퍼블릭 인터넷을 통하여 이용한다. 이게 일반적인 사용 방법임.

이 중에 예외가 있는데, VPC이다.

VPC는 퍼블릭 인터넷에서 접근이 불가능한 것이 원칙.

## VPC

 > 개요
	> "Virtual Private Cloud(VPC)는 사용자의 AWS 계정 전용 가상 네트워크입니다. VPC는 AWS 클라우드에서 다른 가상 네트워크와 논리적으로 분리되어 있습니다. Amazon EC2 인스턴스와 같은 AWS 리소스를 VPC에서 실행할 수 있습니다. IP 주소 범위와 VPC 범위를 설정하고 서브넷을 추가하고 보안 그룹을 연결한 다음 라우팅 테이블을 구성합니다."
	- 가상의 데이터 센터
	- 외부에 격리된 네트워크 컨테이너 구성 가능
		- 여기서 말하는 컨테이너는 도커쓸 때 그런 컨테이너가 아니고 일종의 네트워크를 담을 수 있는 유닛 같은 의미이다.
		- 원하는대로 사설망 구축 가능
			- 부여된 IP 대역을 분할하여 사용 가능
	- 리전 단위

> VPC의 사용 사례

- EC2, RDS, Lambda 등의 AWS의 컴퓨팅 서비스 실행
- 다양한 서브넷 구성
- 보안 설정(IP BLock, 인터넷에 노출되지 않는 EC2 등 구성)

> VPC의 구성 요소

- 서브넷
- 인터넷 게이트웨이
- NACL/보안그룹
- 라우트 테이블
- NAT Instance/NAT Gateway
- Bastion Host
- VPC Endpoint

## 서브넷

- VPC의 하위 단위로 VPC에 할당된 IP를 더 작은 단위로 분할한 개념
- 하나의 서브넷은 하나의 가용 영역(AZ) 안에 위치
- CIDR Block Range로 IP 주소 지정

> AWS 서브넷의 IP 갯수

- AWS의 사용 가능 IP 숫자는 5개를 제외하고 계산
	- ex) 10.0.0.0/24 라면 8비트만 사용하는 것
		- 10.0.0.0: 네트워크 어드레스
		- 10.0.0.1: VPC Router
		- 10.0.0.2: DNS Server
		- 10.0.0.3: 미래에 사용을 위해 남겨둠
		- 10.0.0.255(마지막 번호): 네트워크 브로드캐스트 어드레스(단 브로드캐스트는 지원하지 않음)
		- 즉 총 사용 가능한 IP 갯수는 2^8 - 5 = 251

> 라우트 테이블(Route Table)

- 트래픽이 어디로 가야할 지 알려주는 이정표
- VPC 생성 시 기본으로 하나 제공

|  Destination  |         Target         |
|:-------------:|:----------------------:|
|  10.0.0.0/16  |         local          |
| 172.31.0.0/16 | pcx-112233445566778899 |
|   0.0.0.0/0   |      igw-3830de61      |

- 요청이 들어오게 되면 `Destination` 목록에서 가장 구체적인 것을 찾아서 매칭해서 알려준다
	- ex) 10.0.1.231, 10.0.2.18, 10.0.3.148의 주소가 있다면 10.0.0.0/16, 0.0.0.0/0 둘에게 해당이 되는데 여기서 /16이 더 구체적인 주소이므로 이쪽으로 매칭해준다.
	- ex) 171.32.2.125, 171.32.2.125, 171.31.16.251의 주소가 있다면 172.31.0.0/16, 0.0.0.0/0 둘에게 해당이 되는데 여기서 /16이 더 구체적인 주소이므로 이쪽으로 매칭해준다.
	- ex) 1.23.5.123, 8.8.8.8, 177.44.123.6의 주소가 있다면 0.0.0.0/0(모든 IP)외에 매칭되는 주소가 없으므로 이쪽으로 매칭해준다.

> 서브넷의 종류

- 퍼블릭 서브넷: 외부에서 인터넷을 통해 연결할 수 있는 서브넷
	- 인터넷 게이트웨이([IGW](#인터넷-게이트웨이))를 통해 외부의 인터넷과 연결되어 있음
	- 안에 위치한 인스턴스에 퍼블릭 IP 부여 가능
	- 웹 서버, 애플리케이션 서버 등 유저에게 노출되어야 하는 인프라
- 프라이빗 서브넷: 외부에서 인터넷을 통해 연결할 수 없는 서브넷
	- 외부 인터넷으로 경로가 없음
	- 퍼블릭 IP 부여 불가능
	- 데이터베이스, 로직 서버 등 외부에 노출될 필요가 없는 인프라

## 인터넷 게이트웨이

- VPC가 외부의 인터넷과 통신할 수 있도록 경로를 만들어주는 리소스
- 기본적으로 확장성과 고가용성이 확보되어 있음
- IPv4, IPv6 지원
	- IPv4의 경우 NAT 역할
- Route Table에서 경로 설정 후에 접근 가능
- 무료